# Proddbot in production

The Project:Odd instance of proddbot is running in production on
`redhat-jboss01`.

## Updating the instance

To update the running version, log in to the production machine and
run (this requires sudo rights):

    /home/proddbot/update.sh

This will pull down the latest master, rebuild the uberjar, and
restart the service.

## How it runs

The service is managed as a SysV init service. You can restart, stop,
start, etc with:

    sudo service proddbot restart|start|status|stop

This service is defined in `/etc/init.d/proddbot` and
`/etc/defaults/proddbot`.

## Logging

Logs are written to `/home/proddbot/logs/`, and are automatically
rotated by `cronolog`.

## Jenkins notifications

The url for notifying proddbot of build status is
`http://proddbot.projectodd.org?token=thetoken&channel=immutant`. You
can find the token in `/etc/defaults/proddbot`. The `token` and
`channel` parameters are required - the token is used to authenticate,
and the channel (without the `#` prefix) is where notifications will go.

The url also takes a couple of optional parameters that are used to
set up a watch for the release generated by the build (assuming the
release pushes to Maven Central). An example url that would to that is:

    http://proddbot.projectodd.org?token=thetoken&channel=immutant&ga=org.immutant:web&create_watch=true&version=foo

Where:

* `ga` is a colon-separated pair of group id and artifact id
* `create_watch` has to be `true` to create a watch (don't ask)
* `version` isn't the version of the release, but instead the name of
  the Jenkins parameter that holds the version. It is used to look up
  the version in the Jenkins payload (also don't ask)


## Exposure

The proddbot web server runs on `localhost:8675`, and is exposed to
the world via an Apache reverse proxy configured at
`/etc/httpd/vhost.d/proddbot.projectodd.org.conf`.
